<html>
	<head>
		<title>
			QInfrastructureManager
		</title>
    	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
	</head>
	<body>
		<div class="container">
		  <div class="row">
			<div class="col-12">
			  <table class="table table-bordered text-center" id="vmTable">
				<thead>
				  <tr>
					<th scope="col">name</th>
					<th scope="col">group</th>
					<th scope="col">external IP</th>
					<th scope="col">status</th>
					<th scope="col">Actions</th>
				  </tr>
				</thead>
				<tbody>
					<!-- dynamically added -->
				</tbody>
			  </table>
			</div>
		  </div>
		</div>

    	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
	</body>
</html>

<script>

function addRow(vm) {
	let table = document.getElementById('vmTable');
	let row = table.insertRow();

	let cell1 = row.insertCell(0);
	cell1.innerHTML = vm.name;

	let cell2 = row.insertCell(1);
	cell2.innerHTML = vm.resourceGroup;

	let cell3 = row.insertCell(2);
	cell3.innerHTML = vm.extIp;

	let cell4 = row.insertCell(3);
	cell4.innerHTML = vm.status;

	let cell5 = row.insertCell(4);
	if (vm.status === 'VM running') {
		cell5.innerHTML = `\
		<button type="button" class="disabled btn btn-primary"><i class="fa fa-play"></i></button> \
		<button type="button" class="btn btn-success"><i class="fa fa-power-off"></i></button> \
		`
	} else {
		cell5.innerHTML = `\
		<button type="button" class="btn btn-primary"><i class="fa fa-play"></i></button> \
		<button type="button" class="disabled btn btn-success"><i class="fa fa-power-off"></i></button> \
		`
	}
}

function loadVMs() {
	// Creating Our XMLHttpRequest object
    let xhr = new XMLHttpRequest();
 
    // Making our connection 
    xhr.open('GET', '/vmstatus', true);
 
    // function execute after request is successful
    xhr.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
			let vmArray = JSON.parse(this.responseText).status;
			for (i in vmArray) {
				addRow(vmArray[i])
			}
        }
    }
    // Sending our request
    xhr.send();
}

loadVMs()

</script>
